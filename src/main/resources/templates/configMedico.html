<!DOCTYPE html>
<html lang="es" th:lang="${#locale.language}" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Configuración del médico</title>
    <link rel="shortcut icon" th:href="@{/media/favicon_IA_Medica.ico}" type="image/x-icon">
    <link rel="stylesheet" href="/css/style2.css"/>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<section class="contenedor">

    <div th:replace="~{fragments/header :: header}"></div>

    <section id="main-configMedico" class="section_config" aria-labelledby="titulo-config">
        <header class="config-header">
            <a id="btnVolver" class="btn btn-primario" th:href="@{/usuarios/panelUsuario}">⬅ Volver al panel</a>
            <h2 id="titulo-config">Configuración del médico</h2>
            <button id="btnGuardar" class="btn btn-primario" disabled>Guardar cambios</button>
        </header>

        <nav class="tabs" role="tablist" aria-label="Secciones de configuración">
            <button role="tab" aria-selected="true" id="tab-btn-perfil" aria-controls="tab-perfil" data-tab="perfil">Perfil</button>
            <button role="tab" id="tab-btn-ui" aria-controls="tab-ui" data-tab="ui">Preferencias</button>
            <button role="tab" id="tab-btn-agenda" aria-controls="tab-agenda" data-tab="agenda">Agenda</button>
            <button role="tab" id="tab-btn-notis" aria-controls="tab-notis" data-tab="notis">Notificaciones</button>
            <button role="tab" id="tab-btn-chat" aria-controls="tab-chat" data-tab="chat">Mensajería</button>
            <button role="tab" id="tab-btn-plantillas" aria-controls="tab-plantillas" data-tab="plantillas">Plantillas</button>
            <button role="tab" id="tab-btn-integraciones" aria-controls="tab-integraciones" data-tab="integraciones">Integraciones</button>
            <button role="tab" id="tab-btn-seguridad" aria-controls="tab-seguridad" data-tab="seguridad">Seguridad</button>
            <button role="tab" id="tab-btn-privacidad" aria-controls="tab-privacidad" data-tab="privacidad">Privacidad</button>
            <button role="tab" id="tab-btn-centro" aria-controls="tab-centro" data-tab="centro">Centro</button>
        </nav>

        <main class="tab-panels">
            <!-- PERFIL -->
            <section id="tab-perfil" role="tabpanel" aria-labelledby="tab-btn-perfil">
                <form id="form-perfil" class="grid-2" novalidate>
                    <div class="form-group">
                        <label for="nombreMostrar">Nombre a mostrar</label>
                        <input id="nombreMostrar" name="perfil.nombreMostrar" type="text" />
                        <small class="help">Se mostrará en informes y agenda.</small>
                    </div>
                    <div class="form-group">
                        <label for="especialidad">Especialidad</label>
                        <input id="especialidad" name="perfil.especialidad" type="text" />
                    </div>
                    <div class="form-group">
                        <label for="colegiado">Nº colegiado</label>
                        <input id="colegiado" name="perfil.colegiado" type="text" inputmode="numeric" />
                    </div>
                    <div class="form-group">
                        <label for="bio">Presentación</label>
                        <textarea id="bio" name="perfil.bio" rows="3" maxlength="280"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="firmaTexto">Firma (texto)</label>
                        <!-- CAMBIO A NOMBRE PLANO -->
                        <input id="firmaTexto" name="perfil.firmaTexto" type="text" placeholder="Dr./Dra. …" />
                    </div>
                    <div class="form-group">
                        <label for="firmaImg">Firma (imagen)</label>
                        <!-- el file input puede ir sin name; lo gestiona JS -->
                        <input id="firmaImg" type="file" accept="image/*" />
                        <div id="firmaPreview" class="preview" aria-live="polite"></div>
                    </div>
                </form>
            </section>

            <!-- UI -->
            <section id="tab-ui" role="tabpanel" aria-labelledby="tab-btn-ui" hidden>
                <form id="form-ui" class="grid-2" novalidate>
                    <div class="form-group">
                        <label for="tema">Tema</label>
                        <select id="tema" name="ui.tema">
                            <option value="auto">Automático</option>
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="idioma">Idioma</label>
                        <select id="idioma" name="ui.idioma">
                            <option value="es">Español</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="zona">Zona horaria</label>
                        <input id="zona" name="ui.zonaHoraria" type="text" value="Europe/Madrid" />
                    </div>
                    <div class="form-group">
                        <label for="home">Página de inicio</label>
                        <select id="home" name="ui.home">
                            <option value="dashboard">Dashboard</option>
                            <option value="agenda">Agenda</option>
                            <option value="mensajes">Mensajería</option>
                        </select>
                    </div>
                </form>
            </section>

            <!-- AGENDA -->
            <section id="tab-agenda" role="tabpanel" aria-labelledby="tab-btn-agenda" hidden>
                <form id="form-agenda" class="grid-2" novalidate>
                    <div class="form-group">
                        <label for="duracion">Duración cita (min)</label>
                        <input id="duracion" name="agenda.duracionGeneralMin" type="number" min="5" step="5" value="20"/>
                        <small class="help">Duración por defecto para nuevas citas.</small>
                    </div>

                    <div class="form-group">
                        <label for="buffer">Buffer entre citas (min)</label>
                        <input id="buffer" name="agenda.bufferMin" type="number" min="0" step="5" value="5"/>
                        <small class="help">Minutos de margen entre citas consecutivas.</small>
                    </div>

                    <div class="form-group col-span-2">
                        <label for="reglasJson">Reglas (JSON)</label>
                        <textarea id="reglasJson" name="agenda.reglasJson" rows="4" spellcheck="false">{"antelacionMinHoras":24,"cancelacionMinHoras":6,"overbooking":false}</textarea>
                        <small class="help">Validación al guardar. Ej.: {"antelacionMinHoras":24,"cancelacionMinHoras":6,"overbooking":false}</small>
                    </div>

                    <div class="form-group col-span-2">
                        <label for="disponibilidadJson">Disponibilidad semanal (JSON)</label>
                        <textarea id="disponibilidadJson" name="agenda.disponibilidadJson" rows="6" spellcheck="false">{"lunes":[{"desde":"09:00","hasta":"14:00","ubicacion":"consulta1"}],"martes":[],"miercoles":[],"jueves":[],"viernes":[]}</textarea>
                        <small class="help">Franja por día. Ej.: {"lunes":[{"desde":"09:00","hasta":"14:00"}]}</small>
                    </div>

                    <div class="form-group col-span-2">
                        <label for="instruccionesPorTipoJson">Instrucciones por tipo (JSON)</label>
                        <textarea id="instruccionesPorTipoJson" name="agenda.instruccionesPorTipoJson" rows="4" spellcheck="false">{"general":"Llegue 10' antes","teleconsulta":"Conéctese 5' antes"}</textarea>
                        <small class="help">Textos que verán los pacientes según tipo de cita.</small>
                    </div>
                </form>
            </section>

            <!-- NOTIFICACIONES -->
            <section id="tab-notis" role="tabpanel" aria-labelledby="tab-btn-notis" hidden>
                <form id="form-notis" class="grid-2" novalidate>
                    <fieldset class="form-group">
                        <legend>Canales</legend>
                        <label><input type="checkbox" name="notificaciones.canales.email" checked/> Email</label><br/>
                        <label><input type="checkbox" name="notificaciones.canales.sms"/> SMS</label><br/>
                        <label><input type="checkbox" name="notificaciones.canales.inapp" checked/> In-app</label>
                        <small class="help">Se guardará también en notificaciones.canalesJson (JSON).</small>
                    </fieldset>

                    <fieldset class="form-group">
                        <legend>Eventos</legend>
                        <label><input type="checkbox" name="notificaciones.eventos.nuevaCita" checked/> Nueva cita</label><br/>
                        <label><input type="checkbox" name="notificaciones.eventos.cancelacion" checked/> Cancelación</label><br/>
                        <label><input type="checkbox" name="notificaciones.eventos.noAsiste" checked/> No asiste</label><br/>
                        <label><input type="checkbox" name="notificaciones.eventos.mensaje" checked/> Mensaje</label>
                        <small class="help">Se guardará también en notificaciones.eventosJson (JSON).</small>
                    </fieldset>

                    <div class="form-group">
                        <label for="silencioDesde">Silencio desde</label>
                        <input id="silencioDesde" name="notificaciones.silencioDesde" type="time" value="22:00"/>
                    </div>

                    <div class="form-group">
                        <label for="silencioHasta">Silencio hasta</label>
                        <input id="silencioHasta" name="notificaciones.silencioHasta" type="time" value="07:00"/>
                    </div>

                    <div class="form-group col-span-2">
                        <label for="plantillasJson">Plantillas (JSON)</label>
                        <textarea id="plantillasJson" name="notificaciones.plantillasJson" rows="4" spellcheck="false">{"nuevaCita":"Hola {paciente}, su cita es el {fecha}."}</textarea>
                    </div>
                </form>
            </section>

            <!-- MENSAJERÍA -->
            <!-- MENSAJERÍA -->
            <section id="tab-chat" role="tabpanel" aria-labelledby="tab-btn-chat" hidden>
                <form id="form-chat" class="grid-2" novalidate>
                    <div class="form-group">
                        <label for="estadoChat">Estado</label>
                        <select id="estadoChat" name="chat.estado">
                            <option value="DISPONIBLE">Disponible</option>
                            <option value="OCUPADO">Ocupado</option>
                            <option value="AUSENTE">Ausente</option>
                        </select>
                        <small class="help">Tu estado visible para otros médicos y pacientes.</small>
                    </div>

                    <div class="form-group">
                        <label for="firmaChat">Firma de chat</label>
                        <input id="firmaChat" name="chat.firmaChat" type="text" placeholder="Dr./Dra. {nombre}" />
                    </div>

                    <div class="form-group col-span-2">
                        <label for="respuestasRapidasJson">Respuestas rápidas (JSON)</label>
                        <textarea id="respuestasRapidasJson" name="chat.respuestasRapidasJson" rows="5" spellcheck="false">
                        {"hola":"Hola, ¿en qué puedo ayudarte?","gracias":"Gracias, que tenga un buen día."}
                        </textarea>
                        <small class="help">Formato JSON. Ejemplo: {"hola":"Hola, ¿cómo estás?"}</small>
                    </div>
                </form>
            </section>

            <!-- PLANTILLAS -->
            <!-- PLANTILLAS -->
            <section id="tab-plantillas" role="tabpanel" aria-labelledby="tab-btn-plantillas" hidden>
                <form id="form-plantillas" class="grid-2" novalidate>
                    <div class="form-group">
                        <label for="tipoPlantilla">Tipo</label>
                        <select id="tipoPlantilla" name="plantillas.tipo">
                            <option value="INFORME">Informe médico</option>
                            <option value="MENSAJE">Mensaje</option>
                            <option value="OTRO">Otro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="nombrePlantilla">Nombre</label>
                        <input id="nombrePlantilla" name="plantillas.nombre" type="text" placeholder="Ej. Seguimiento mensual" />
                    </div>

                    <div class="form-group col-span-2">
                        <label for="contenidoPlantilla">Contenido</label>
                        <textarea id="contenidoPlantilla" name="plantillas.contenido" rows="6" placeholder="Escribe aquí la plantilla..."></textarea>
                        <small class="help">Puedes usar variables como {paciente}, {fecha}, {doctor}.</small>
                    </div>
                </form>
            </section>

            <!-- INTEGRACIONES -->
            <!-- INTEGRACIONES -->
            <section id="tab-integraciones" role="tabpanel" aria-labelledby="tab-btn-integraciones" hidden>
                <form id="form-integraciones" class="grid-2" novalidate>
                    <fieldset class="form-group">
                        <legend>Servicios externos</legend>
                        <label><input type="checkbox" name="integraciones.googleCalendar" /> Google Calendar</label><br/>
                        <label><input type="checkbox" name="integraciones.outlookCalendar" /> Outlook Calendar</label><br/>
                        <label><input type="checkbox" name="integraciones.smsProvider" /> Proveedor SMS</label>
                    </fieldset>

                    <div class="form-group col-span-2">
                        <label for="apiKeysJson">API Keys (JSON)</label>
                        <textarea id="apiKeysJson" name="integraciones.apiKeysJson" rows="4" spellcheck="false">
                        {"google":"","outlook":"","sms":""}
                        </textarea>
                        <small class="help">Ejemplo: {"google":"AIza...","outlook":"XXXX","sms":"key_123"}</small>
                    </div>
                </form>
            </section>

            <!-- SEGURIDAD -->
            <!-- SEGURIDAD -->
            <section id="tab-seguridad" role="tabpanel" aria-labelledby="tab-btn-seguridad" hidden>
                <form id="form-seguridad" class="grid-2" novalidate>
                    <div class="form-group">
                        <label for="nuevaPassword">Nueva contraseña</label>
                        <input id="nuevaPassword" name="seguridad.nuevaPassword" type="password" minlength="6" />
                        <small class="help">Debe tener al menos 6 caracteres.</small>
                    </div>
                    <div class="form-group">
                        <label for="confirmarPassword">Confirmar contraseña</label>
                        <input id="confirmarPassword" name="seguridad.confirmarPassword" type="password" minlength="6" />
                    </div>

                    <fieldset class="form-group col-span-2">
                        <legend>Autenticación en dos pasos (2FA)</legend>
                        <label><input type="checkbox" name="seguridad.activar2FA" /> Activar verificación 2FA</label>
                        <small class="help">Recibirás un código temporal en tu dispositivo al iniciar sesión.</small>
                    </fieldset>
                </form>
            </section>


            <!-- PRIVACIDAD -->
            <!-- PRIVACIDAD -->
            <section id="tab-privacidad" role="tabpanel" aria-labelledby="tab-btn-privacidad" hidden>
                <form id="form-privacidad" class="grid-2" novalidate>
                    <fieldset class="form-group">
                        <legend>Visibilidad del perfil</legend>
                        <label><input type="radio" name="privacidad.visibilidad" value="PUBLICO" checked/> Público (otros médicos pueden ver tu perfil)</label><br/>
                        <label><input type="radio" name="privacidad.visibilidad" value="LIMITADO"/> Limitado (solo pacientes asignados)</label><br/>
                        <label><input type="radio" name="privacidad.visibilidad" value="PRIVADO"/> Privado (oculto para todos)</label>
                    </fieldset>

                    <fieldset class="form-group">
                        <legend>Consentimientos</legend>
                        <label><input type="checkbox" name="privacidad.usoDatos" checked/> Permitir uso de mis datos con fines estadísticos</label><br/>
                        <label><input type="checkbox" name="privacidad.boletines"/> Aceptar recibir boletines o comunicaciones internas</label>
                    </fieldset>
                </form>
            </section>


            <!-- CENTRO -->
            <!-- CENTRO -->
            <section id="tab-centro" role="tabpanel" aria-labelledby="tab-btn-centro" hidden>
                <form id="form-centro" class="grid-2" novalidate>
                    <div class="form-group">
                        <label for="nombreCentro">Nombre del centro</label>
                        <input id="nombreCentro" name="centro.nombreCentro" type="text" placeholder="Ej. Clínica San José" />
                    </div>

                    <div class="form-group">
                        <label for="telefonoCentro">Teléfono</label>
                        <input id="telefonoCentro" name="centro.telefonoCentro" type="tel" placeholder="+34 900 123 456" />
                    </div>

                    <div class="form-group">
                        <label for="direccionCentro">Dirección</label>
                        <input id="direccionCentro" name="centro.direccionCentro" type="text" placeholder="Calle Mayor, 10, Madrid" />
                    </div>

                    <div class="form-group">
                        <label for="horarioCentro">Horario de atención</label>
                        <input id="horarioCentro" name="centro.horarioCentro" type="text" placeholder="Lun-Vie 9:00–14:00" />
                    </div>

                    <div class="form-group col-span-2">
                        <label for="serviciosCentro">Servicios ofrecidos (JSON)</label>
                        <textarea id="serviciosCentro" name="centro.serviciosCentroJson" rows="4" spellcheck="false">
                        {"cardiologia":true,"pediatria":true,"psicologia":false}
                        </textarea>
                        <small class="help">Ejemplo: {"cardiologia":true,"pediatria":true}</small>
                    </div>
                </form>
            </section>
        </main>

        <footer class="config-footer">
            <span id="estadoGuardado" aria-live="polite"></span>
        </footer>
    </section>

    <div th:replace="~{fragments/footer :: footer}"></div>
</section>

<!-- Importa el JS correcto -->
<script th:src="@{/js/configMedico.js}" defer></script>
</body>
</html>
