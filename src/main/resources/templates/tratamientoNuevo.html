<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <title>Nuevo/Editar tratamiento (M√©dico)</title>
    <link rel="stylesheet" href="/css/style2.css" />
    <script src="/js/darkTheme.js" defer></script>
    <script src="/js/script.js" defer></script> <!-- ojo al typo sccript.js -->
    <link rel="shortcut icon" th:href="@{/media/favicon_IA_Medica.ico}" type="image/x-icon">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="page-container">
    <!-- Header Section -->
    <div class="header-section">
        <h1>
            <span>üíä</span>
            <span id="page-title">Nuevo Tratamiento</span>
        </h1>
        <p class="subtitle" id="patient-name">Para: Juan P√©rez</p>
    </div>

    <!-- Info Box (opcional) -->
    <div class="info-box">
        <span class="icon">üí°</span>
        <p>Complete todos los campos requeridos para registrar el tratamiento m√©dico del paciente.</p>
    </div>

    <!-- Form Container -->
    <div class="form-container">
        <form id="treatment-form">
            <!-- Patient Selection (if needed) -->
            <div class="form-field full-width" id="patient-selector-field">
                <label for="patient-select">
                    <span>üë§</span>
                    Paciente
                    <span class="required">*</span>
                </label>
                <select id="patient-select" required>
                    <option value="">Selecciona un usuario</option>
                    <option value="1">Juan P√©rez</option>
                    <option value="2">Mar√≠a Garc√≠a</option>
                    <option value="3">Carlos L√≥pez</option>
                </select>
            </div>

            <!-- Medication Information -->
            <div class="form-section-title">
                <span>üíä</span>
                Informaci√≥n del Medicamento
            </div>

            <div class="form-grid">
                <div class="form-field">
                    <label for="nombre_tratamiento">
                        Medicamento
                        <span class="required">*</span>
                    </label>
                    <input
                            type="text"
                            id="nombre_tratamiento"
                            name="nombre_tratamiento"
                            placeholder="ej. Paracetamol"
                            required
                    >
                    <span class="error-message">Este campo es obligatorio</span>
                </div>

                <div class="form-field">
                    <label for="formula">Forma farmac√©utica</label>
                    <select id="formula" name="formula">
                        <option value="">Seleccionar...</option>
                        <option value="tableta">Tableta</option>
                        <option value="jarabe">Jarabe</option>
                        <option value="inyectable">Inyectable</option>
                        <option value="capsula">C√°psula</option>
                        <option value="suspension">Suspensi√≥n</option>
                        <option value="pomada">Pomada</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="dosis">Dosis</label>
                    <input
                            type="text"
                            id="dosis"
                            name="dosis"
                            placeholder="ej. 500 mg"
                    >
                    <span class="help-text">Especifique la cantidad por toma</span>
                </div>

                <div class="form-field">
                    <label for="frecuencia">Frecuencia</label>
                    <input
                            type="text"
                            id="frecuencia"
                            name="frecuencia"
                            placeholder="ej. cada 8 horas"
                    >
                    <span class="help-text">Intervalo entre dosis</span>
                </div>
            </div>

            <!-- Treatment Schedule -->
            <div class="form-section-title">
                <span>üìÖ</span>
                Cronograma del Tratamiento
            </div>

            <div class="form-grid">
                <div class="form-field">
                    <label for="fecha_inicio">
                        <span>üìÜ</span>
                        Fecha de inicio
                    </label>
                    <input
                            type="date"
                            id="fecha_inicio"
                            name="fecha_inicio"
                    >
                </div>

                <div class="form-field">
                    <label for="fecha_fin">
                        <span>üèÅ</span>
                        Fecha de fin
                    </label>
                    <input
                            type="date"
                            id="fecha_fin"
                            name="fecha_fin"
                    >
                </div>

                <div class="form-field">
                    <label for="toma_alimentos">
                        <span>üçΩÔ∏è</span>
                        Con alimentos
                    </label>
                    <select id="toma_alimentos" name="toma_alimentos">
                        <option value="true">S√≠</option>
                        <option value="false">No</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="estado_tratamiento">
                        <span>üìä</span>
                        Estado
                    </label>
                    <select id="estado_tratamiento" name="estado_tratamiento">
                        <option value="">Seleccionar...</option>
                        <option value="Activo" selected>Activo</option>
                        <option value="Pausado">Pausado</option>
                        <option value="Finalizado">Finalizado</option>
                    </select>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section-title">
                <span>üìù</span>
                Informaci√≥n Adicional
            </div>

            <div class="form-grid">
                <div class="form-field full-width">
                    <label for="sintomas">
                        <span>ü©∫</span>
                        S√≠ntomas relacionados
                    </label>
                    <input
                            type="text"
                            id="sintomas"
                            name="sintomas"
                            placeholder="ej. dolor, fiebre, malestar general..."
                    >
                    <span class="help-text">S√≠ntomas que motivan este tratamiento</span>
                </div>

                <div class="form-field full-width">
                    <label for="observaciones">
                        <span>üìã</span>
                        Observaciones
                    </label>
                    <textarea
                            id="observaciones"
                            name="observaciones"
                            placeholder="Instrucciones adicionales, precauciones o notas importantes..."
                    ></textarea>
                    <span class="help-text">Informaci√≥n adicional relevante para el tratamiento</span>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <span>üíæ</span>
                    <span id="submit-text">Guardar tratamiento</span>
                </button>
                <a href="#" class="btn btn-secondary" id="back-btn">
                    <span>‚Ü©Ô∏è</span>
                    Volver
                </a>
            </div>
        </form>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    // Simulate different modes: 'create' or 'edit'
    const mode = 'create'; // Change to 'edit' to test edit mode
    const hasPreselectedPatient = true; // Change to false to show patient selector

    // Update UI based on mode
    if (mode === 'edit') {
        document.getElementById('page-title').textContent = 'Editar Tratamiento';
        document.getElementById('submit-text').textContent = 'Guardar cambios';

        // Populate form with existing data (simulation)
        document.getElementById('nombre_tratamiento').value = 'Paracetamol';
        document.getElementById('formula').value = 'tableta';
        document.getElementById('dosis').value = '500mg';
        document.getElementById('frecuencia').value = 'cada 8h';
        document.getElementById('fecha_inicio').value = '2025-01-15';
        document.getElementById('fecha_fin').value = '2025-01-22';
        document.getElementById('sintomas').value = 'Fiebre';
        document.getElementById('observaciones').value = 'Reposo durante 3 d√≠as';
    }

    // Hide patient selector if patient is preselected
    if (hasPreselectedPatient) {
        document.getElementById('patient-selector-field').style.display = 'none';
    }

    // Form validation
    const form = document.getElementById('treatment-form');
    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const submitBtn = form.querySelector('.btn-primary');
        const nombreTratamiento = document.getElementById('nombre_tratamiento');

        // Basic validation
        if (!nombreTratamiento.value.trim()) {
            nombreTratamiento.closest('.form-field').classList.add('error');
            nombreTratamiento.focus();
            return;
        }

        // Remove error state
        nombreTratamiento.closest('.form-field').classList.remove('error');

        // Show loading state
        submitBtn.classList.add('loading');
        submitBtn.disabled = true;

        // Simulate form submission
        setTimeout(() => {
            alert('‚úÖ Tratamiento guardado correctamente');
            // In real implementation: window.location.href = '/medico/tratamientos';
            submitBtn.classList.remove('loading');
            submitBtn.disabled = false;
        }, 1500);
    });

    // Clear error on input
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            this.closest('.form-field')?.classList.remove('error');
        });
    });

    // Date validation: end date should be after start date
    const startDate = document.getElementById('fecha_inicio');
    const endDate = document.getElementById('fecha_fin');

    startDate.addEventListener('change', function() {
        if (endDate.value && this.value > endDate.value) {
            alert('‚ö†Ô∏è La fecha de inicio no puede ser posterior a la fecha de fin');
            this.value = '';
        }
    });

    endDate.addEventListener('change', function() {
        if (startDate.value && this.value < startDate.value) {
            alert('‚ö†Ô∏è La fecha de fin no puede ser anterior a la fecha de inicio');
            this.value = '';
        }
    });

    // Back button
    document.getElementById('back-btn').addEventListener('click', function(e) {
        e.preventDefault();
        if (confirm('¬øDeseas salir sin guardar los cambios?')) {
            // window.location.href = '/medico/tratamientos';
            history.back();
        }
    });
</script>
</body>
</html>