<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Tratamientos</title>
    <link rel="shortcut icon" th:href="@{/media/favicon_IA_Medica.ico}" type="image/x-icon">
    <link rel="stylesheet" th:href="@{/css/style2.css}">
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<main id="main-tratamientos">
    <!-- Formulario de nuevo tratamiento -->
    <section class="trat-section">
        <div class="trat-header">
            <h2>üíä Nuevo Tratamiento</h2>
            <p class="trat-subtitle">Registra la informaci√≥n del medicamento y su dosificaci√≥n</p>
        </div>

        <form id="formulario-tratamientos" class="trat-form" th:action="@{/guardarTratamiento}" method="post" th:object="${tratamiento}">

            <!-- Informaci√≥n b√°sica del medicamento -->
            <div class="trat-form-group">
                <label for="nombre_tratamiento">
                    <span class="label-icon">üíä</span>
                    Nombre del medicamento
                </label>
                <input type="text" id="nombre_tratamiento" th:field="*{nombre_tratamiento}" placeholder="Ej: Paracetamol" required>
            </div>

            <!-- Forma, dosis y duraci√≥n en 3 columnas -->
            <div class="trat-form-row--triple">
                <div class="trat-form-group">
                    <label for="forma_farmaceutica">
                        <span class="label-icon">üì¶</span>
                        Forma farmac√©utica
                    </label>
                    <select id="forma_farmaceutica" th:field="*{formula}">
                        <option value="">Seleccionar...</option>
                        <option value="tableta">Tableta</option>
                        <option value="jarabe">Jarabe</option>
                        <option value="inyectable">Inyectable</option>
                        <option value="capsula">C√°psula</option>
                        <option value="crema">Crema</option>
                        <option value="gotas">Gotas</option>
                    </select>
                </div>

                <div class="trat-form-group">
                    <label for="dosis">
                        <span class="label-icon">‚öñÔ∏è</span>
                        Dosis
                    </label>
                    <input type="text" id="dosis" th:field="*{dosis}" placeholder="Ej: 500 mg" required>
                </div>

                <div class="trat-form-group">
                    <label for="duracion">
                        <span class="label-icon">üìÖ</span>
                        Duraci√≥n (d√≠as)
                    </label>
                    <input type="number" id="duracion" th:field="*{duracion}" min="1" placeholder="Ej: 7" required>
                </div>
            </div>

            <!-- Frecuencia -->
            <div class="trat-form-group">
                <label for="frecuencia">
                    <span class="label-icon">üïê</span>
                    Frecuencia
                </label>
                <input type="text" id="frecuencia" th:field="*{frecuencia}" placeholder="Ej: Cada 8h, 1 vez al d√≠a">
            </div>

            <!-- Fechas -->
            <div class="trat-form-row">
                <div class="trat-form-group">
                    <label for="inicio">
                        <span class="label-icon">üóìÔ∏è</span>
                        Fecha de inicio
                    </label>
                    <input type="date" id="inicio" th:field="*{fecha_inicio}" required>
                </div>

                <div class="trat-form-group">
                    <label for="fin">
                        <span class="label-icon">üèÅ</span>
                        Fecha de fin
                    </label>
                    <input type="date" id="fin" th:field="*{fecha_fin}" required>
                </div>
            </div>

            <!-- Checkbox -->
            <div class="trat-form-group">
                <label class="trat-checkbox">
                    <input type="checkbox" id="con_alimentos" th:field="*{toma_alimentos}">
                    <span class="checkbox-label">
                                <span class="label-icon">üçΩÔ∏è</span>
                                Tomar con alimentos
                            </span>
                </label>
            </div>

            <!-- Observaciones -->
            <div class="trat-form-group">
                <label for="observaciones">
                    <span class="label-icon">üìù</span>
                    Observaciones
                </label>
                <textarea id="observaciones" th:field="*{observaciones}" rows="3" placeholder="Notas adicionales sobre el tratamiento..."></textarea>
            </div>

            <!-- Estado y s√≠ntomas -->
            <div class="trat-form-row">
                <div class="trat-form-group">
                    <label for="estado">
                        <span class="label-icon">üîÑ</span>
                        Estado
                    </label>
                    <select id="estado" th:field="*{estado_tratamiento}">
                        <option value="activo">Activo</option>
                        <option value="finalizado">Finalizado</option>
                    </select>
                </div>

                <div class="trat-form-group">
                    <label for="relacion_sintomas">
                        <span class="label-icon">ü©∫</span>
                        S√≠ntomas relacionados
                    </label>
                    <input type="text" id="relacion_sintomas" th:field="*{sintomas}" placeholder="Ej: Presi√≥n alta, dolor de cabeza">
                </div>
            </div>

            <!-- Bot√≥n submit -->
            <div class="trat-form-actions">
                <button type="submit" class="trat-btn-primary">
                    ‚úÖ Guardar tratamiento
                </button>
                <button type="reset" class="trat-btn-secondary">
                    üîÑ Limpiar formulario
                </button>
            </div>
        </form>
    </section>

    <!-- Lista de tratamientos registrados -->
    <section class="trat-section">
        <div class="trat-header">
            <h2>üìã Tratamientos Registrados</h2>
            <p class="trat-subtitle">Historial completo de medicamentos</p>
        </div>

        <!-- Contenedor de cards -->
        <div class="trat-cards-container">
            <!-- Card por cada tratamiento (Thymeleaf loop) -->
            <article class="trat-card" th:each="tratamiento : ${tratamientos}"
                     th:classappend="${tratamiento.estado_tratamiento == 'activo'} ? 'trat-card--activo' : 'trat-card--finalizado'">

                <!-- Header del card -->
                <div class="trat-card__header">
                    <div class="trat-card__title-group">
                        <h3 class="trat-card__title" th:text="${tratamiento.nombre_tratamiento}">Paracetamol</h3>
                        <span class="trat-badge trat-badge--formula" th:text="${tratamiento.formula}">tableta</span>
                    </div>
                    <span class="trat-badge"
                          th:classappend="${tratamiento.estado_tratamiento == 'activo'} ? 'trat-badge--activo' : 'trat-badge--finalizado'"
                          th:text="${tratamiento.estado_tratamiento}">
                                activo
                            </span>
                </div>

                <!-- Body del card -->
                <div class="trat-card__body">
                    <!-- Dosis y frecuencia -->
                    <div class="trat-card__info-grid">
                        <div class="trat-info-item">
                            <span class="trat-info-label">‚öñÔ∏è Dosis</span>
                            <span class="trat-info-value" th:text="${tratamiento.dosis}">500 mg</span>
                        </div>
                        <div class="trat-info-item">
                            <span class="trat-info-label">üïê Frecuencia</span>
                            <span class="trat-info-value" th:text="${tratamiento.frecuencia}">cada 8h</span>
                        </div>
                        <div class="trat-info-item">
                            <span class="trat-info-label">üìÖ Duraci√≥n</span>
                            <span class="trat-info-value" th:text="${tratamiento.duracion} + ' d√≠as'">7 d√≠as</span>
                        </div>
                    </div>

                    <!-- Fechas -->
                    <div class="trat-card__dates">
                        <div class="trat-date-item">
                            <span class="trat-date-label">Inicio</span>
                            <span class="trat-date-value" th:text="${tratamiento.fecha_inicio}">2025-09-04</span>
                        </div>
                        <span class="trat-date-arrow">‚Üí</span>
                        <div class="trat-date-item">
                            <span class="trat-date-label">Fin</span>
                            <span class="trat-date-value" th:text="${tratamiento.fecha_fin}">2025-09-15</span>
                        </div>
                    </div>

                    <!-- Informaci√≥n adicional -->
                    <div class="trat-card__details">
                        <div class="trat-detail-row" th:if="${tratamiento.toma_alimentos}">
                            <span class="trat-detail-icon">üçΩÔ∏è</span>
                            <span class="trat-detail-text">Tomar con alimentos</span>
                        </div>
                        <div class="trat-detail-row" th:if="${tratamiento.sintomas != null and tratamiento.sintomas != ''}">
                            <span class="trat-detail-icon">ü©∫</span>
                            <span class="trat-detail-text">
                                        <strong>Relacionado:</strong>
                                        <span th:text="${tratamiento.sintomas}">Presi√≥n alta</span>
                                    </span>
                        </div>
                        <div class="trat-detail-row" th:if="${tratamiento.observaciones != null and tratamiento.observaciones != ''}">
                            <span class="trat-detail-icon">üìù</span>
                            <span class="trat-detail-text" th:text="${tratamiento.observaciones}">Reposo durante 3 d√≠as</span>
                        </div>
                    </div>
                </div>

                <!-- Footer con ID -->
                <div class="trat-card__footer">
                    <span class="trat-card__id">ID: <span th:text="${tratamiento.id_tratamiento}">1</span></span>
                </div>
            </article>

            <!-- Mensaje si no hay tratamientos -->
            <div class="trat-empty" th:if="${#lists.isEmpty(tratamientos)}">
                <div class="trat-empty__icon">üíä</div>
                <p class="trat-empty__text">No hay tratamientos registrados a√∫n</p>
                <p class="trat-empty__subtext">Comienza agregando tu primer medicamento usando el formulario de arriba</p>
            </div>
        </div>
    </section>
</main>

<div th:replace="fragments/footer :: footer"></div>

<script th:src="@{/js/darkTheme.js}" defer></script>
<script th:src="@{/js/tratamientos.js}"></script>
</body>
</html>