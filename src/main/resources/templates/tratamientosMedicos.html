<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <title>Tratamientos del paciente (M√©dico)</title>
    <link rel="shortcut icon" th:href="@{/media/favicon_IA_Medica.ico}" type="image/x-icon">
    <link rel="stylesheet" th:href="@{/css/style2.css}"/>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<div class="tratamientos-page">

    <!-- Header Section -->
    <div class="tratamientos-header">
        <div class="tratamientos-header-content">
            <div class="tratamientos-title-section">
                <h1 class="tratamientos-title">
                    <span class="tratamientos-icon">üíä</span>
                    Tratamientos del Paciente
                </h1>
                <p class="tratamientos-subtitle">Gesti√≥n y seguimiento de tratamientos m√©dicos</p>
            </div>

            <div class="tratamientos-patient-selector">
                <label for="patient-select">Paciente:</label>
                <select id="patient-select" class="patient-select-input" onchange="filtrarPorPaciente(this.value)">
                    <option value="" th:selected="${idSeleccionado == null}">Todos</option>
                    <option th:each="u : ${usuarios}"
                            th:value="${u.id_usuario}"
                            th:text="${u.cliente != null ? u.cliente.nombre + ' ' + u.cliente.apellidos : u.username}"
                            th:selected="${idSeleccionado != null and idSeleccionado == u.id_usuario}">
                    </option>
                </select>
            </div>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="tratamientos-actions">
        <a th:href="@{/usuarios/panelUsuario}" class="btn-action btn-secondary">
            <span class="btn-icon">‚Üê</span>
            Volver al panel
        </a>

        <div class="tratamientos-stats">
            <div class="stat-item">
                <span class="stat-value" th:text="${totalActivos}">0</span>
                <span class="stat-label">Activos</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" th:text="${totalFinalizados}">0</span>
                <span class="stat-label">Finalizados</span>
            </div>
        </div>

        <a th:href="@{/medico/nuevo}" class="btn-action btn-primary">
            <span class="btn-icon">+</span>
            Nuevo tratamiento
        </a>
    </div>

    <!-- Success Alert -->
    <div class="alert alert-success" style="display: none;">
        <span class="alert-icon">‚úì</span>
        Tratamiento guardado correctamente
    </div>

    <!-- Filters -->
    <div class="tratamientos-filters">
        <button class="filter-btn active" data-filter="todos">
            Todos <span class="filter-count" th:text="${#lists.size(tratamientos)}">0</span>
        </button>
        <button class="filter-btn" data-filter="activo">
            Activos <span class="filter-count" th:text="${totalActivos}">0</span>
        </button>
        <button class="filter-btn" data-filter="finalizado">
            Finalizados <span class="filter-count" th:text="${totalFinalizados}">0</span>
        </button>
    </div>

    <!-- Cards Grid -->
    <div class="tratamientos-grid">

        <!-- Card 1 - Finalizado -->
        <div class="tratamiento-card" data-estado="finalizado">
            <div class="card-header">
                <div class="card-title-section">
                    <h3 class="card-medicamento">Paracetamol</h3>
                    <span class="badge badge-finalizado">Finalizado</span>
                </div>
                <span class="card-id">#1</span>
            </div>

            <div class="card-body">
                <div class="card-info-grid">
                    <div class="info-item">
                        <span class="info-label">F√≥rmula</span>
                        <span class="info-value">Tableta</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Dosis</span>
                        <span class="info-value info-highlight">500mg</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Frecuencia</span>
                        <span class="info-value">Cada 8h</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Con alimentos</span>
                        <span class="info-value">
                            <span class="badge-mini badge-yes">S√≠</span>
                        </span>
                    </div>
                </div>

                <div class="card-dates">
                    <div class="date-item">
                        <span class="date-label">Inicio</span>
                        <span class="date-value">04/09/2025</span>
                    </div>
                    <span class="date-separator">‚Üí</span>
                    <div class="date-item">
                        <span class="date-label">Fin</span>
                        <span class="date-value">15/09/2025</span>
                    </div>
                </div>

                <div class="card-section">
                    <span class="section-label">S√≠ntomas tratados</span>
                    <span class="section-value">N/R</span>
                </div>

                <div class="card-section">
                    <span class="section-label">Observaciones</span>
                    <p class="section-text">Reposo durante 3 d√≠as</p>
                </div>
            </div>

            <div class="card-actions">
                <button class="card-btn btn-edit">
                    <span>‚úè</span> Editar
                </button>
                <button class="card-btn btn-delete" onclick="return confirm('¬øSeguro que deseas eliminar este tratamiento?')">
                    <span>üóë</span> Eliminar
                </button>
            </div>
        </div>

        <!-- Card 2 - Activo -->
        <div class="tratamiento-card" data-estado="activo">
            <div class="card-header">
                <div class="card-title-section">
                    <h3 class="card-medicamento">Nolotil</h3>
                    <span class="badge badge-activo">Activo</span>
                </div>
                <span class="card-id">#2</span>
            </div>

            <div class="card-body">
                <div class="card-info-grid">
                    <div class="info-item">
                        <span class="info-label">F√≥rmula</span>
                        <span class="info-value">Jarabe</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Dosis</span>
                        <span class="info-value info-highlight">1g</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Frecuencia</span>
                        <span class="info-value">Cada 6h, 2 veces d√≠as</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Con alimentos</span>
                        <span class="info-value">
                            <span class="badge-mini badge-yes">S√≠</span>
                        </span>
                    </div>
                </div>

                <div class="card-dates">
                    <div class="date-item">
                        <span class="date-label">Inicio</span>
                        <span class="date-value">15/07/2025</span>
                    </div>
                    <span class="date-separator">‚Üí</span>
                    <div class="date-item">
                        <span class="date-label">Fin</span>
                        <span class="date-value">22/07/2025</span>
                    </div>
                </div>

                <div class="card-section">
                    <span class="section-label">S√≠ntomas tratados</span>
                    <span class="section-value section-highlight">Presi√≥n alta</span>
                </div>

                <div class="card-section">
                    <span class="section-label">Observaciones</span>
                    <p class="section-text">Ninguna</p>
                </div>
            </div>

            <div class="card-actions">
                <button class="card-btn btn-edit">
                    <span>‚úè</span> Editar
                </button>
                <button class="card-btn btn-complete">
                    <span>‚úì</span> Finalizar
                </button>
                <button class="card-btn btn-delete" onclick="return confirm('¬øSeguro que deseas eliminar este tratamiento?')">
                    <span>üóë</span> Eliminar
                </button>
            </div>
        </div>

        <!-- Card 3 - Finalizado -->
        <div class="tratamiento-card" data-estado="finalizado">
            <div class="card-header">
                <div class="card-title-section">
                    <h3 class="card-medicamento">Ibuprofeno</h3>
                    <span class="badge badge-finalizado">Finalizado</span>
                </div>
                <span class="card-id">#4</span>
            </div>

            <div class="card-body">
                <div class="card-info-grid">
                    <div class="info-item">
                        <span class="info-label">F√≥rmula</span>
                        <span class="info-value">Inyectable</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Dosis</span>
                        <span class="info-value info-highlight">500mg</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Frecuencia</span>
                        <span class="info-value">Cada 2h</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Con alimentos</span>
                        <span class="info-value">
                            <span class="badge-mini badge-yes">S√≠</span>
                        </span>
                    </div>
                </div>

                <div class="card-dates">
                    <div class="date-item">
                        <span class="date-label">Inicio</span>
                        <span class="date-value">23/07/2025</span>
                    </div>
                    <span class="date-separator">‚Üí</span>
                    <div class="date-item">
                        <span class="date-label">Fin</span>
                        <span class="date-value">26/07/2025</span>
                    </div>
                </div>

                <div class="card-section">
                    <span class="section-label">S√≠ntomas tratados</span>
                    <span class="section-value">N/R</span>
                </div>

                <div class="card-section">
                    <span class="section-label">Observaciones</span>
                    <p class="section-text">Ninguna</p>
                </div>
            </div>

            <div class="card-actions">
                <button class="card-btn btn-edit">
                    <span>‚úè</span> Editar
                </button>
                <button class="card-btn btn-delete" onclick="return confirm('¬øSeguro que deseas eliminar este tratamiento?')">
                    <span>üóë</span> Eliminar
                </button>
            </div>
        </div>

        <!-- Card 4 - Finalizado -->
        <div class="tratamiento-card" data-estado="finalizado">
            <div class="card-header">
                <div class="card-title-section">
                    <h3 class="card-medicamento">Quiste poliqu√≠stico</h3>
                    <span class="badge badge-finalizado">Finalizado</span>
                </div>
                <span class="card-id">#5</span>
            </div>

            <div class="card-body">
                <div class="card-info-grid">
                    <div class="info-item">
                        <span class="info-label">F√≥rmula</span>
                        <span class="info-value">Tableta</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Dosis</span>
                        <span class="info-value info-highlight">2mg</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Frecuencia</span>
                        <span class="info-value">1 al d√≠a</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Con alimentos</span>
                        <span class="info-value">
                            <span class="badge-mini badge-no">No</span>
                        </span>
                    </div>
                </div>

                <div class="card-dates">
                    <div class="date-item">
                        <span class="date-label">Inicio</span>
                        <span class="date-value">18/09/2025</span>
                    </div>
                    <span class="date-separator">‚Üí</span>
                    <div class="date-item">
                        <span class="date-label">Fin</span>
                        <span class="date-value">18/09/2026</span>
                    </div>
                </div>

                <div class="card-section">
                    <span class="section-label">S√≠ntomas tratados</span>
                    <span class="section-value section-highlight">Quiste poliqu√≠stico</span>
                </div>

                <div class="card-section">
                    <span class="section-label">Observaciones</span>
                    <p class="section-text">Realizar la toma antes de dormir</p>
                </div>
            </div>

            <div class="card-actions">
                <button class="card-btn btn-edit">
                    <span>‚úè</span> Editar
                </button>
                <button class="card-btn btn-delete" onclick="return confirm('¬øSeguro que deseas eliminar este tratamiento?')">
                    <span>üóë</span> Eliminar
                </button>
            </div>
        </div>

        <!-- Card 5 - Finalizado -->
        <div class="tratamiento-card" data-estado="finalizado">
            <div class="card-header">
                <div class="card-title-section">
                    <h3 class="card-medicamento">Sibila</h3>
                    <span class="badge badge-finalizado">Finalizado</span>
                </div>
                <span class="card-id">#6</span>
            </div>

            <div class="card-body">
                <div class="card-info-grid">
                    <div class="info-item">
                        <span class="info-label">F√≥rmula</span>
                        <span class="info-value">Tableta</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Dosis</span>
                        <span class="info-value info-highlight">32mg</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Frecuencia</span>
                        <span class="info-value">Cada 24 horas</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Con alimentos</span>
                        <span class="info-value">
                            <span class="badge-mini badge-yes">S√≠</span>
                        </span>
                    </div>
                </div>

                <div class="card-dates">
                    <div class="date-item">
                        <span class="date-label">Inicio</span>
                        <span class="date-value">01/10/2025</span>
                    </div>
                    <span class="date-separator">‚Üí</span>
                    <div class="date-item">
                        <span class="date-label">Fin</span>
                        <span class="date-value">22/10/2025</span>
                    </div>
                </div>

                <div class="card-section">
                    <span class="section-label">S√≠ntomas tratados</span>
                    <span class="section-value section-highlight">Quiste</span>
                </div>

                <div class="card-section">
                    <span class="section-label">Observaciones</span>
                    <p class="section-text">Ninguna</p>
                </div>
            </div>

            <div class="card-actions">
                <button class="card-btn btn-edit">
                    <span>‚úè</span> Editar
                </button>
                <button class="card-btn btn-delete" onclick="return confirm('¬øSeguro que deseas eliminar este tratamiento?')">
                    <span>üóë</span> Eliminar
                </button>
            </div>
        </div>

    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>

<script>
    // Show success message if parameter exists
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('success')) {
        document.querySelector('.alert-success').style.display = 'flex';
        setTimeout(() => {
            document.querySelector('.alert-success').style.display = 'none';
        }, 5000);
    }

    // Filter functionality
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // Remove active class from all buttons
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');

            const filter = this.dataset.filter;
            const cards = document.querySelectorAll('.tratamiento-card');

            cards.forEach(card => {
                if (filter === 'todos') {
                    card.style.display = 'block';
                } else {
                    const estado = card.dataset.estado;
                    card.style.display = estado === filter ? 'block' : 'none';
                }
            });
        });
    });

    // Filtrar por paciente
    function filtrarPorPaciente(idUsuario) {
        if (idUsuario === '' || idUsuario === null) {
            window.location.href = '/medico/tratamientos';
        } else {
            window.location.href = '/medico/tratamientos?id_usuario=' + idUsuario;
        }
    }
</script>
<script th:src="@{/js/darkTheme.js}" defer></script>
<script th:src="@{/js/sccript.js}" defer></script>
</body>
</html>