<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Historial MÃ©dico</title>
    <link rel="stylesheet" th:href="@{/css/style2.css}">
    <link rel="shortcut icon" th:href="@{/media/favicon_IA_Medica.ico}" type="image/x-icon">
</head>
<body>
<section class="contenedor">
    <div th:replace="~{fragments/header :: header}"></div>

    <main id="panel-historialMedico">
        <h2>Historial MÃ©dico de <span th:text="${usuario.nombre} + ' ' + ${usuario.apellidos}"></span></h2>
        <section>
            <form th:action="@{/guardarHistorial}" method="post" th:object="${historial}">
                <input type="date" name="fecha" required>

                <select name="tipoEvento" required>
                    <option value="CONSULTA">Consulta</option>
                    <option value="TRATAMIENTO">Tratamiento</option>
                    <option value="ANALISIS">AnÃ¡lisis</option>
                    <option value="SEGUIMIENTO">Seguimiento</option>
                    <option value="OTRO">Otro</option>
                </select>

                <input type="text" name="motivo" placeholder="Motivo">
                <input type="text" name="diagnostico" placeholder="DiagnÃ³stico">
                <input type="text" name="tratamiento" placeholder="Tratamiento">
                <textarea name="notas" placeholder="Notas del profesional"></textarea>

                <button type="submit">Guardar</button>
            </form>

        </section>
        <article class="historial-container">
            <div class="filtro">
                <label for="fecha">Filtrar por fecha:</label>
                <input type="date" id="fecha">
                <button onclick="filtrarHistorial()">Filtrar</button>
                <button onclick="limpiarFiltro()">Quitar filtro</button>
            </div>

            <table class="historial-tabla">
                <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Motivo</th>
                    <th>DiagnÃ³stico</th>
                    <th>Tratamiento</th>
                    <th>Notas</th>
                    <th>Archivo</th>
                </tr>
                </thead>
                <tbody id="historial-body">
                <tr th:each="registro : ${historial}">
                    <td th:text="${registro.fecha}"></td>
                    <td th:text="${registro.tipoEvento}"></td>
                    <td th:text="${registro.motivo}"></td>
                    <td th:text="${registro.diagnostico}"></td>
                    <td th:text="${registro.tratamiento}"></td>
                    <td th:text="${registro.notas}"></td>
                    <td>
                        <a th:if="${registro.archivoUrl != null}"
                           th:href="@{${registro.archivoUrl}}" target="_blank">ðŸ“„ Ver</a>
                        <span th:if="${registro.archivoUrl == null}">â€“</span>
                    </td>
                </tr>
                </tbody>
            </table>
        </article>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
</section>

<script th:src="@{/js/asistente.js}"></script>
<script th:src="@{/js/darkTheme.js}"></script>
<script th:src="@{/js/panelUsuario.js}"></script>
<script th:src="@{/js/filtroHistorial.js}"></script>
</body>
</html>
